# Word Count Job
# Pipeline: SocketSource -> SplitWords -> Count -> SocketSink
#
# Usage:
#   bicycle run jobs/wordcount.yaml
#
# Connect:
#   nc localhost 9999  # Send input text
#   nc localhost 9998  # Receive word counts

name: wordcount
description: "Counts words from socket input and outputs counts to socket"

config:
  parallelism: 1
  checkpoint_interval_ms: 60000
  max_restarts: 3
  restart_delay_ms: 5000

vertices:
  - id: source
    name: "Socket Source"
    operator: source
    parallelism: 1
    connector:
      type: socket
      properties:
        host: "0.0.0.0"
        port: "9999"

  - id: flatmap
    name: "Split Words"
    operator: flatmap
    parallelism: 1
    config:
      function: split_words

  - id: count
    name: "Word Count"
    operator: count
    parallelism: 1

  - id: sink
    name: "Socket Sink"
    operator: sink
    parallelism: 1
    connector:
      type: socket
      properties:
        host: "0.0.0.0"
        port: "9998"

edges:
  - from: source
    to: flatmap
    partition: forward

  - from: flatmap
    to: count
    partition: forward

  - from: count
    to: sink
    partition: forward
